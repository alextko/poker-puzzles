<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Probability Quiz</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212; /* Dark background */
            color: #ffffff; /* White text */
            margin: 0; /* Remove default margin */
            padding: 0; /* Remove default padding */
            display: flex; /* Use flexbox for centering */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            height: 100vh; /* Full viewport height */
            font-size: 14px; /* Decreased from 16px or more */
        }

        .container {
            max-width: 500px; /* Reduced width to make overall interface smaller */
            padding: 15px; /* Increased padding for better spacing */
            text-align: center;
            background-color: #1e1e1e; /* Darker container */
            border-radius: 8px; /* Rounded corners */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); /* Shadow effect */
        }

        h1 {
            font-size: 24px; /* Decreased from 32px */
            margin-bottom: 15px; /* Increased margin */
            text-shadow: 0 0 10px #00bfff, 0 0 20px #00bfff; /* Glowing effect */
        }

        .card {
            display: inline-block;
            width: 36px; /* Smaller size for hole cards */
            height: 50px;
            border: 2px solid #0099cc; /* Darker blue border */
            border-radius: 6px; /* Rounded corners */
            margin: 3px; /* Margin between cards */
            text-align: center;
            line-height: 50px;
            font-size: 16px; /* Font size */
            background-color: #ffffff; /* Dark card background */
            color: #ffffff; /* White text */
            transition: transform 0.2s, box-shadow 0.2s; /* Smooth transition */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); /* Shadow for 3D effect */
        }

        .card:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7); /* Enhanced shadow on hover */
        }

        .flop-card {
            display: inline-block;
            width: 48px; /* Size for flop cards */
            height: 70px;
            border: 2px solid #0099cc; /* Darker blue border */
            border-radius: 6px; /* Rounded corners */
            margin: 3px; /* Margin between cards */
            text-align: center;
            line-height: 70px;
            font-size: 16px; /* Font size */
            background-color: #ffffff; /* Dark card background */
            color: #ffffff; /* White text */
            transition: transform 0.2s, box-shadow 0.2s; /* Smooth transition */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); /* Shadow for 3D effect */
        }

        .flop-card:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7); /* Enhanced shadow on hover */
        }

        .button {
            padding: 6px 10px; /* Button padding */
            margin: 6px; /* Margin between buttons */
            font-size: 14px; /* Font size */
            cursor: pointer;
            background-color: #0099cc; /* Darker blue background */
            color: #ffffff; /* White text */
            border: none; /* No border */
            border-radius: 6px; /* Rounded corners */
            transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transition */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); /* Shadow for 3D effect */
        }

        .button:hover {
            background-color: #0077a3; /* Darker blue on hover */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7); /* Enhanced shadow on hover */
            transform: translateY(-2px); /* Lift effect on hover */
        }

        .hand-option {
            margin: 4px; /* Margin for hand options */
            padding: 3px; /* Padding for hand options */
            background-color: #1e1e1e; /* Dark background */
            display: inline-block; /* Inline block for layout */
            border-radius: 4px; /* Rounded corners */
            border: none; /* Remove border */
        }

        .result {
            margin-top: 3px; /* Margin for results */
            font-weight: bold; /* Bold text */
        }

        .correct {
            color: #00ff00; /* Green for correct */
        }

        .incorrect {
            color: #ff0000; /* Red for incorrect */
        }

        #score {
            font-size: 16px; /* Score font size */
            margin: 10px; /* Margin for score */
        }

        .probability-input {
            width: 40px; /* Input width */
            padding: 3px; /* Input padding */
            margin: 0 3px; /* Margin for inputs */
            text-align: center; /* Center text */
            font-size: 14px; /* Font size */
            background-color: #2a2a2a; /* Dark background */
            color: #a0a0a0; /* Darker grey text for placeholder */
            border: none; /* Remove border */
            border-radius: 4px; /* Rounded corners */
            box-shadow: inset 0 0 3px rgba(255, 255, 255, 0.2), 0 2px 4px rgba(0, 0, 0, 0.5); /* Inset shadow for 3D effect */
        }

        .probability-input::placeholder {
            color: #a0a0a0; /* Darker grey placeholder text */
            opacity: 1; /* Ensure placeholder is fully opaque */
        }

        .card-container {
            margin-bottom: 16px; /* Increased margin for card containers */
        }

        .flop-container {
            margin-bottom: 16px; /* Margin for flop container */
        }

        .probability-row {
            display: flex; /* Flexbox for layout */
            justify-content: center; /* Center items */
            flex-wrap: wrap; /* Wrap items */
            margin-top: 10px; /* Margin for probability row */
        }

        .hand-option {
            margin: 0 4px; /* Margin for hand options */
        }

        /* Make hearts/diamonds appear red, spades/clubs appear black */
        .red {
            color: red;
        }
        .black {
            color: black;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Poker Probability Quiz</h1>
        
        <div class="flop-container">
            <h3>Flop Cards:</h3>
            <div id="community-cards" class="card-container"></div>
        </div>

        <div class="card-container">
            <h3>Hole Cards:</h3>
            <div id="hole-cards" class="card-container"></div>
        </div>
        
        <div class="probability-row" id="hand-options">
            <!-- <h3>What's the probability of getting:</h3> -->
            <!-- Hand options will be populated by createHandOptions() (below) -->
        </div>

        <div id="score">
            <span id="correct-count">0</span> / <span id="total-count">0</span>
        </div>
        
        <button class="button" id="check-answer" onclick="checkAnswers()">Check</button>
        <button class="button" onclick="newHand()">Deal</button>
        <button class="button" onclick="exitQuiz()">Exit</button>

        <div id="results"></div>
    </div>

    <script>
        const handTypes = [
            "Pair",
            "Two Pair",
            "Three of a Kind",
            "Straight",
            "Flush",
            "Full House",
            "Four of a Kind",
            "Straight Flush"
        ];

        function createHandOptions() {
            const container = document.getElementById('hand-options');
            container.innerHTML = '';
            
            handTypes.forEach(handType => {
                const div = document.createElement('div');
                div.className = 'hand-option';
                div.innerHTML = `
                    <label>${handType}</label>
                    <input type="number" 
                           class="probability-input" 
                           id="${handType}-input"
                           min="0" 
                           max="100" 
                           step="0.1" 
                           placeholder="0">%
                    <div class="result" id="${handType}-result"></div>
                `;
                container.appendChild(div);
            });
        }

        function newHand() {
            fetch('/new_hand', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                displayCards('hole-cards', data.hole_cards, 'hole');
                displayCards('community-cards', data.community_cards, 'flop');
                createHandOptions();
                clearResults();
            })
            .catch(console.error);
        }

        function clearResults() {
            handTypes.forEach(handType => {
                const resultDiv = document.getElementById(`${handType}-result`);
                if (resultDiv) resultDiv.innerHTML = '';
            });
        }

        async function checkAnswers() {
            const guesses = {};
            handTypes.forEach(ht => {
                const rawVal = document.getElementById(`${ht}-input`).value;
                guesses[ht] = parseFloat(rawVal) || 0;
            });

            try {
                const res = await fetch("/poker_quiz/check_all", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ guesses })
                });
                const data = await res.json();

                const results = data.results;
                Object.entries(results).forEach(([handType, info]) => {
                    const resultDiv = document.getElementById(`${handType}-result`);
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <span class="${info.correct ? 'correct' : 'incorrect'}">
                                Actual: ${info.actual_prob.toFixed(1)}%
                                ${info.correct ? '✓' : '✗'}
                            </span>
                        `;
                    }
                });

                document.getElementById('correct-count').textContent = 
                    data.correct_answers;  
                document.getElementById('total-count').textContent = 
                    data.total_questions;

            } catch (err) {
                console.error(err);
            }
        }

        function displayCards(containerId, cards, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = type === 'flop' ? 'flop-card' : 'card';
                cardElement.classList.add(isRed(card) ? 'red' : 'black');
                cardElement.textContent = card;
                container.appendChild(cardElement);
            });
        }

        function isRed(card) {
            return card.includes('♥') || card.includes('♦');
        }

        async function exitQuiz() {
            try {
                const res = await fetch("/exit_quiz", { method: "POST" });
                const data = await res.json();
                if (data.redirect) {
                    window.location.replace(data.redirect);
                }
            } catch (err) {
                console.error(err);
            }
        }

        window.onload = () => {
            createHandOptions();
            newHand();
        };
    </script>
</body>
</html>